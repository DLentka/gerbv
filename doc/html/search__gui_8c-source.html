<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gerbv: src/search_gui.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8-20040928 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>search_gui.c</h1><a href="search__gui_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * gEDA - GNU Electronic Design Automation</span>
00003 <span class="comment"> * This file is a part of gerbv.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> *   Copyright (C) 2004 Juergen Haas (juergenhaas@gmx.net)</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * $Id$</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> *                                      Juergen H. (juergenhaas@gmx.net) </span>
00010 <span class="comment"> *                                      and Tomasz M. (T.Motylewski@bfad.de)</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
00013 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00014 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00015 <span class="comment"> * (at your option) any later version.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00018 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00019 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00020 <span class="comment"> * GNU General Public License for more details.</span>
00021 <span class="comment"> *</span>
00022 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00023 <span class="comment"> * along with this program; if not, write to the Free Software</span>
00024 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111 USA</span>
00025 <span class="comment"> */</span>
00026 
00030 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00032 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_CONFIG_H */</span>
00033 
00034 <span class="preprocessor">#ifdef USE_GTK2</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00037 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00038 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00039 <span class="preprocessor">#include &lt;math.h&gt;</span>
00040 
00041 <span class="preprocessor">#include &lt;errno.h&gt;</span>
00042 <span class="preprocessor">#ifdef HAVE_REGEX_H</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;regex.h&gt;</span>
00044 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_REGEX_H */</span>
00045 
00046 <span class="preprocessor">#ifdef HAVE_STRING_H</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string.h&gt;</span>
00048 <span class="preprocessor">#endif</span>
00049 <span class="preprocessor"></span>
00050 <span class="preprocessor">#ifdef HAVE_UNISTD_H</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
00052 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_UNISTD_H */</span>
00053 
00054 <span class="preprocessor">#include &lt;gtk/gtk.h&gt;</span>
00055 <span class="preprocessor">#include &lt;gdk/gdk.h&gt;</span>
00056 <span class="preprocessor">#include &lt;gdk/gdkkeysyms.h&gt;</span>
00057 <span class="preprocessor">#include &lt;glib/gunicode.h&gt;</span>
00058 
00059 <span class="preprocessor">#ifdef HAVE_GETOPT_H</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;getopt.h&gt;</span>
00061 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_GETOPT_H */</span>
00062 
00063 <span class="preprocessor">#ifdef USE_GTK2</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#include &lt;pango/pango.h&gt;</span>
00065 <span class="preprocessor">#endif </span><span class="comment">/* USE_GTK2 */</span>
00066 
00067 <span class="preprocessor">#include &lt;glib/gi18n.h&gt;</span>
00068 <span class="preprocessor">#include "gerber.h"</span>
00069 <span class="preprocessor">#include "drill.h"</span>
00070 <span class="preprocessor">#include "gerb_error.h"</span>
00071 <span class="preprocessor">#include "draw.h"</span>
00072 <span class="preprocessor">#include "color.h"</span>
00073 <span class="preprocessor">#include "gerbv_screen.h"</span>
00074 <span class="preprocessor">#include "gerbv_icon.h"</span>
00075 <span class="preprocessor">#include "search.h"</span>
00076 <span class="preprocessor">#include "search_cb.h"</span>
00077 <span class="preprocessor">#include "search_file.h"</span>
00078 <span class="preprocessor">#include "search_gui.h"</span>
00079 <span class="preprocessor">#include "search_mark.h"</span>
00080 <span class="preprocessor">#include "log.h"</span>
00081 <span class="preprocessor">#include "setup.h"</span>
00082 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00083 
00084 <span class="preprocessor">#include "search_gui.h"</span>
00085 <span class="comment">/* CHECKME - here gi18n is disabled */</span>
00086 <span class="comment">//#define _(String) (String)</span>
00087 
<a name="l00088"></a><a class="code" href="search__gui_8c.html#a0">00088</a> <a class="code" href="structpnp__state.html">pnp_state_t</a>  *parsed_PNP_data;
00089 
00090 GtkListStore        *combo_box_model;
00091 <span class="comment">//GtkListStore        *model_completion; </span>
00092 GtkEntryCompletion  *entry_completion;
00093 <span class="keywordtype">char</span> composed_entry[MAXL] = <span class="stringliteral">""</span>;
00094 
<a name="l00099"></a><a class="code" href="search__gui_8c.html#a5">00099</a> <span class="keywordtype">void</span> <a class="code" href="search__gui_8c.html#a5">select_by_regex</a>(GtkWidget     *widget,  gpointer          data) 
00100 {
00101     GtkTreeIter       iter;
00102     gboolean          no_files_found = FALSE;
00103     gchar            *designator;
00104     gchar            *comment;
00105 <span class="preprocessor">#ifdef HAVE_REGEX_H</span>
00106 <span class="preprocessor"></span>    regex_t           regexec_pattern; 
00107 <span class="preprocessor">#endif</span>
00108 <span class="preprocessor"></span>    <span class="keyword">const</span> gchar      *entry; 
00109     gchar             regex[MAXL]=<span class="stringliteral">""</span>;
00110     gboolean          match, nomatch;
00111     gboolean          designator_active, comment_active;
00112   <span class="comment">//  int             not_in_list = 0;</span>
00113     GList            *selection_list, *first_in_list;
00114     GtkTreeSelection  *tree_sel;
00115     
00116 
00117         
00118     <span class="keywordflow">if</span>(!gtk_tree_model_get_iter_first (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter)) {
00119         GERB_MESSAGE(<span class="stringliteral">"empty interface.model\n"</span>);
00120         <span class="keywordflow">return</span>;
00121     }                        
00122     designator_active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>));
00123     comment_active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a>));
00124     
00125     entry_completion = gtk_entry_completion_new ();  
00126     gtk_entry_set_completion( GTK_ENTRY(interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>), entry_completion);
00127     gtk_entry_completion_set_model (entry_completion, GTK_TREE_MODEL(<a class="code" href="search__file_8c.html#a0">completion_model</a>));
00128    
00129      <span class="keywordflow">if</span> (((!designator_active) &amp;&amp; (!comment_active)) || ((designator_active) &amp;&amp; (!comment_active))) {
00130         gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>), TRUE);  
00131         designator_active = TRUE;
00132         gtk_entry_completion_set_text_column (entry_completion, 0); 
00133     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!designator_active) &amp;&amp; (comment_active)) {
00134         gtk_entry_completion_set_text_column (entry_completion, 1); 
00135     }
00136     
00137     entry = gtk_entry_get_text(GTK_ENTRY(gtk_entry_completion_get_entry(entry_completion)));
00138     composed_entry[1] = <span class="charliteral">'\0'</span>;
00139    <span class="comment">/* if (entry == "*") {</span>
00140 <span class="comment">        entry[0] = '.';</span>
00141 <span class="comment">        entry[1] = '*';</span>
00142 <span class="comment">        entry[2] = '\0';</span>
00143 <span class="comment">    }*/</span>
00144     <span class="keywordflow">if</span>   (entry[0] != <span class="charliteral">'\0'</span>) {
00145  
00146         <span class="comment">/* This following code is working, it will add a new entry to the list, unfortunately it </span>
00147 <span class="comment">         * is not useful when selecting all R or similar bcause the new entries will not have the</span>
00148 <span class="comment">         * necessary data</span>
00149 <span class="comment">        gtk_tree_model_get_iter_first(GTK_TREE_MODEL(completion_model), &amp;iter);</span>
00150 <span class="comment">        do {</span>
00151 <span class="comment">        gtk_tree_model_get (GTK_TREE_MODEL(completion_model), &amp;iter, 0, &amp;tmp_entry , -1);</span>
00152 <span class="comment">        if (strncasecmp(tmp_entry, entry, strlen(tmp_entry)) != 0 ){</span>
00153 <span class="comment">            not_in_list = 1;</span>
00154 <span class="comment">           // GERB_MESSAGE("new in the gang %s\n", entry)</span>
00155 <span class="comment">        }</span>
00156 <span class="comment">       // GERB_MESSAGE("entry&gt;%s\n",tmp_entry);</span>
00157 <span class="comment">        } while (gtk_tree_model_iter_next(GTK_TREE_MODEL(completion_model), &amp;iter));</span>
00158 <span class="comment">        if (not_in_list == 1) {</span>
00159 <span class="comment">            gtk_list_store_append (completion_model, &amp;iter); </span>
00160 <span class="comment">            gtk_list_store_set (completion_model, &amp;iter, 0, entry, -1);</span>
00161 <span class="comment">            gtk_entry_completion_set_model (entry_completion, GTK_TREE_MODEL(completion_model));</span>
00162 <span class="comment">        }Enter the users entries-&gt;problems with non existing data on a cumulative selection*/</span>
00163 
00164         
00165         <span class="keywordflow">if</span>(sscanf(entry, <span class="stringliteral">"%100s"</span>, regex)==1 &amp;&amp; regex[0]) {
00166             <span class="comment">// TODO transform * into .*, ? into . i.e. find char make sure it is </span>
00167             <span class="comment">//single (and not already .*) and trafo it</span>
00168 <span class="preprocessor">#ifdef HAVE_REGEX_H</span>
00169 <span class="preprocessor"></span>              regcomp (&amp;regexec_pattern, regex , REG_ICASE);  <span class="comment">//compiles regexp string</span>
00170 <span class="comment">//              regcomp (&amp;regexec_pattern, regex , REG_NOSUB);  //compiles regexp string</span>
00171 <span class="preprocessor">#endif</span>
00172 <span class="preprocessor"></span>            nomatch = FALSE;
00173         } <span class="keywordflow">else</span> {
00174             nomatch = TRUE;
00175         }
00176         <span class="keywordflow">do</span> {
00177             gtk_tree_model_get (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter,
00178                 COLUMN_DESIGNATOR, &amp;designator,
00179                 COLUMN_COMMENT, &amp;comment,
00180                 COLUMN_NO_FILES_FOUND, &amp;no_files_found,
00181                       -1);
00182            match = FALSE;     
00183               
00184             <span class="keywordflow">if</span>(!nomatch) {
00185 <span class="preprocessor">#ifdef HAVE_REGEX_H</span>
00186 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ((designator_active) &amp;&amp; (designator != NULL))
00187                     match = (regexec (&amp;regexec_pattern, designator, 0, 0, 0) != REG_NOMATCH);
00188                 <span class="keywordflow">if</span> ((comment_active) &amp;&amp; (comment != NULL))
00189                     match = match || (regexec (&amp;regexec_pattern, comment, 0, 0, 0) != REG_NOMATCH);
00190 <span class="preprocessor">#else </span>
00191 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ((designator_active) &amp;&amp; (designator != NULL))
00192                     match = (strstr (designator, regex) != NULL);
00193                 <span class="keywordflow">if</span> ((comment_active) &amp;&amp; (comment != NULL))
00194                     match = match || (strstr (comment, regex) != NULL);    
00195 <span class="comment">/*?use      g_utf8_strdown (const gchar *str, gssize len); before strstr and maybe g_strstr_len?*/</span>
00196 <span class="preprocessor">#endif     </span>
00197 <span class="preprocessor"></span>            }
00198             <span class="keywordflow">if</span>(match) {
00199                 gtk_tree_selection_select_iter (GTK_TREE_SELECTION(interface.<a class="code" href="struct__InterfaceStruct.html#o19">selection</a>), &amp;iter);
00200             } <span class="keywordflow">else</span> {
00201                 gtk_tree_selection_unselect_iter (GTK_TREE_SELECTION(interface.<a class="code" href="struct__InterfaceStruct.html#o19">selection</a>), &amp;iter);
00202             }
00203         } <span class="keywordflow">while</span> (gtk_tree_model_iter_next(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter)); 
00204    
00205         selection_list = gtk_tree_selection_get_selected_rows
00206                                                 (GTK_TREE_SELECTION(interface.<a class="code" href="struct__InterfaceStruct.html#o19">selection</a>),
00207                                                  (GtkTreeModel **)&amp;interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>);
00208         <span class="keywordflow">if</span> (selection_list != NULL) {                                         
00209             first_in_list = g_list_first(selection_list);                                             
00210         
00211             gtk_tree_view_scroll_to_cell    (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>),
00212                                                   first_in_list-&gt;data,
00213                                                   COLUMN_DESIGNATOR,
00214                                                   TRUE,
00215                                                   0.3,
00216                                                   0.5);
00217         }                                                  
00218      <span class="comment">//   g_list_foreach (selection_list, gtk_tree_path_free, NULL);                                          </span>
00219       <span class="comment">//  g_list_free (selection_list);                                          </span>
00220       <span class="comment">//  g_list_foreach (first_in_list, gtk_tree_path_free, NULL);</span>
00221       <span class="comment">//  g_list_free (first_in_list);                                          </span>
00222         g_free (designator);
00223         g_free (comment);
00224         } <span class="keywordflow">else</span> {
00225             tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
00226             gtk_tree_selection_unselect_all (tree_sel);
00227             <span class="comment">/*hitting enter on nothing entered will deselect all*/</span>
00228         }
00229         <span class="keywordflow">return</span>;
00230 } <span class="comment">/* select_by_regex */</span>
00231 
00232 
00240 GtkWidget *
<a name="l00241"></a><a class="code" href="search__gui_8c.html#a6">00241</a> <a class="code" href="search__gui_8c.html#a6">create_search_results_section</a> (<span class="keywordtype">void</span>)
00242 {
00243     GtkWidget              *label;
00244     GtkWidget              *vbox;
00245     GtkWidget       *hbox;
00246     GtkWidget       *window;       
00247     GtkTreeViewColumn *column;     
00248     GtkCellRenderer   *renderer;
00249     
00250            
00251    
00252     vbox = gtk_vbox_new (FALSE, 6);       
00253     
00254     hbox = gtk_hbox_new (FALSE, 12);
00255     gtk_box_pack_start (GTK_BOX (vbox), hbox, FALSE, FALSE, 0);
00256     
00257     label = gtk_label_new_with_mnemonic (_(<span class="stringliteral">"S_earch results:"</span>));
00258     g_object_set (G_OBJECT(label), <span class="stringliteral">"xalign"</span>, 0.0, NULL);
00259     gtk_box_pack_start (GTK_BOX (hbox), label, TRUE, TRUE, 0);
00260     
00261     interface.<a class="code" href="struct__InterfaceStruct.html#o11">results_label</a> = gtk_label_new (NULL);
00262     g_object_set (G_OBJECT (interface.<a class="code" href="struct__InterfaceStruct.html#o11">results_label</a>), <span class="stringliteral">"xalign"</span>, 1.0, NULL);
00263     gtk_box_pack_start (GTK_BOX (hbox), interface.<a class="code" href="struct__InterfaceStruct.html#o11">results_label</a>, FALSE, FALSE, 0);
00264     
00265     window = gtk_scrolled_window_new (NULL, NULL);
00266     gtk_scrolled_window_set_shadow_type (GTK_SCROLLED_WINDOW(window), GTK_SHADOW_NONE);    
00267     gtk_container_set_border_width (GTK_CONTAINER(window), 0);
00268     gtk_widget_set_size_request (window, 330, 160); 
00269     gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW(window),
00270                                     GTK_POLICY_AUTOMATIC,
00271                                     GTK_POLICY_AUTOMATIC);
00272 <span class="comment">/*interface.model = */</span>   
00273 
00274      interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a> = gtk_list_store_new (NUM_COLUMNS, 
00275                                                   G_TYPE_STRING, <span class="comment">// COLUMN_DESIGNATOR</span>
00276                                                   G_TYPE_STRING, <span class="comment">// COLUMN_footprint</span>
00277                                       G_TYPE_DOUBLE, <span class="comment">// COLUMN_mid_x</span>
00278                                                   G_TYPE_DOUBLE, <span class="comment">// COLUMN_mid_y</span>
00279                                       G_TYPE_DOUBLE, <span class="comment">// COLUMN_ref_x</span>
00280                                       G_TYPE_DOUBLE, <span class="comment">// COLUMN_ref_y</span>
00281                                       G_TYPE_DOUBLE, <span class="comment">// COLUMN_pad_x</span>
00282                                       G_TYPE_DOUBLE, <span class="comment">// COLUMN_pad_y</span>
00283                                       G_TYPE_STRING, <span class="comment">// COLUMN_LAYER</span>
00284                                       G_TYPE_DOUBLE, <span class="comment">// COLUMN_rotation</span>
00285                                                   G_TYPE_DOUBLE, <span class="comment">// COLUMN_length</span>
00286                                                   G_TYPE_DOUBLE, <span class="comment">// COLUMN_width</span>
00287                                                   G_TYPE_INT, <span class="comment">// COLUMN_shape</span>
00288                                       G_TYPE_STRING, <span class="comment">// COLUMN_COMMENT</span>
00289                                       G_TYPE_BOOLEAN); <span class="comment">// COLUMN_NO_FILES_FOUND</span>
00290                                                                        
00291     interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a> = gtk_tree_view_new_with_model (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>));
00292     gtk_tree_view_set_headers_visible (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), TRUE);                                    
00293     gtk_tree_view_set_rules_hint (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), TRUE);
00294 <span class="comment">//     g_object_unref (G_OBJECT(interface.model));</span>
00295     interface.<a class="code" href="struct__InterfaceStruct.html#o19">selection</a> = gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
00296     gtk_tree_selection_set_mode (GTK_TREE_SELECTION(interface.<a class="code" href="struct__InterfaceStruct.html#o19">selection</a>),
00297                                  GTK_SELECTION_MULTIPLE);
00298                              
00299 <span class="comment">/*     gtk_drag_source_set (interface.tree, </span>
00300 <span class="comment">                      GDK_BUTTON1_MASK | GDK_BUTTON2_MASK,</span>
00301 <span class="comment">                      dnd_table, n_dnds, </span>
00302 <span class="comment">                      GDK_ACTION_COPY | GDK_ACTION_MOVE);</span>
00303 <span class="comment"></span>
00304 <span class="comment">    g_signal_connect (G_OBJECT (interface.tree), </span>
00305 <span class="comment">                    "drag_data_get",</span>
00306 <span class="comment">                    G_CALLBACK (drag_file_cb), </span>
00307 <span class="comment">                    NULL);</span>
00308 <span class="comment">                    </span>
00309 <span class="comment">    g_signal_connect (G_OBJECT (interface.tree),</span>
00310 <span class="comment">                    "drag_begin",</span>
00311 <span class="comment">                    G_CALLBACK (drag_begin_file_cb),</span>
00312 <span class="comment">                    NULL);    </span>
00313 <span class="comment">       */</span>       
00314        g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), 
00315                     <span class="stringliteral">"event_after"</span>,
00316                     G_CALLBACK(<a class="code" href="search__gui_8c.html#a18">file_event_after_cb</a>), 
00317                     NULL);
00318                     
00319     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), 
00320                     <span class="stringliteral">"button_release_event"</span>,
00321                     G_CALLBACK(file_button_release_event_cb), 
00322                     NULL);
00323     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>),
00324                     <span class="stringliteral">"key_press_event"</span>,
00325                     G_CALLBACK(<a class="code" href="search__gui_8c.html#a21">file_key_press_event_cb</a>),
00326                     NULL);
00327                            
00328     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), 
00329                     <span class="stringliteral">"button_press_event"</span>,
00330                     G_CALLBACK(file_button_press_event_cb), 
00331                     NULL);            
00332                     
00333     gtk_label_set_mnemonic_widget (GTK_LABEL (label), interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>);
00334     
00335     gtk_container_add (GTK_CONTAINER(window), GTK_WIDGET(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
00336     gtk_box_pack_end (GTK_BOX (vbox), window, TRUE, TRUE, 0);
00337      
00338     <span class="comment">/*gtk_tree_view_column_set_visible () */</span>    
00339 
00340     <span class="comment">/* create the Designator column */</span>
00341     renderer = gtk_cell_renderer_text_new ();          
00342     interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a> = gtk_tree_view_column_new_with_attributes (_(<span class="stringliteral">"Designator"</span>), renderer,
00343                                                  <span class="stringliteral">"text"</span>,COLUMN_DESIGNATOR,
00344                                                  NULL);
00345     gtk_tree_view_column_set_sizing (interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>, GTK_TREE_VIEW_COLUMN_AUTOSIZE);
00346     gtk_tree_view_column_set_resizable (interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>, TRUE);
00347     gtk_tree_view_column_set_sort_column_id (interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>, COLUMN_DESIGNATOR); 
00348     gtk_tree_view_append_column (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>);
00349     
00350      <span class="comment">/* create the fooprint column */</span>
00351     renderer = gtk_cell_renderer_text_new ();          
00352     interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a> = gtk_tree_view_column_new_with_attributes (_(<span class="stringliteral">"Footprint"</span>), renderer,
00353                                                  <span class="stringliteral">"text"</span>,COLUMN_footprint,
00354                                                  NULL);
00355     gtk_tree_view_column_set_sizing (interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>, GTK_TREE_VIEW_COLUMN_AUTOSIZE);
00356     gtk_tree_view_column_set_resizable (interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>, TRUE);
00357     gtk_tree_view_column_set_sort_column_id (interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>, COLUMN_footprint); 
00358     gtk_tree_view_append_column (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), interface.<a class="code" href="struct__InterfaceStruct.html#o4">column</a>);
00359 
00360     
00361     <span class="comment">/* create the Layer column */</span>
00362     renderer = gtk_cell_renderer_text_new ();
00363   <span class="comment">//  g_object_set( renderer, "xalign", 1.0, NULL);</span>
00364     column = gtk_tree_view_column_new_with_attributes (_(<span class="stringliteral">"Layer"</span>), renderer,
00365                                                  <span class="stringliteral">"text"</span>, COLUMN_LAYER,
00366                                                  NULL);
00367     gtk_tree_view_column_set_sizing (column, GTK_TREE_VIEW_COLUMN_AUTOSIZE);
00368     gtk_tree_view_column_set_resizable (column, TRUE);
00369     gtk_tree_view_column_set_sort_column_id (column, COLUMN_LAYER);
00370     gtk_tree_view_append_column (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), column);
00371 
00372     <span class="comment">/* create the type column */</span> 
00373     renderer = gtk_cell_renderer_text_new ();
00374     column = gtk_tree_view_column_new_with_attributes (_(<span class="stringliteral">"Comment"</span>), renderer,
00375                                                  <span class="stringliteral">"text"</span>, COLUMN_COMMENT,
00376                                                  NULL);
00377     gtk_tree_view_column_set_sizing (column, GTK_TREE_VIEW_COLUMN_AUTOSIZE);
00378     gtk_tree_view_column_set_resizable (column, TRUE);
00379     gtk_tree_view_column_set_sort_column_id (column, COLUMN_COMMENT);
00380     gtk_tree_view_append_column (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), column);
00381 
00382     <span class="keywordflow">return</span> vbox;
00383 
00384 } <span class="comment">/* create_search_results_section */</span>
00385 
00390 GtkWidget *
<a name="l00391"></a><a class="code" href="search__gui_8c.html#a7">00391</a> <a class="code" href="search__gui_8c.html#a7">create_main_search_window</a> (<span class="keywordtype">void</span>)
00392 {
00393     <span class="comment">//GtkTargetEntry  drag_types[] = { { "text/uri-list", 0, 0 } };</span>
00394     GtkWidget                *hbox;       
00395     GtkWidget         *vbox;
00396     GtkWidget         *label;
00397     GtkWidget                *window;
00398     GtkTooltips         *tooltips = gtk_tooltips_new();
00399     <span class="keywordtype">int</span>                 idx;
00400     <span class="keywordtype">char</span>                s_MAX_FILES[MAXL] = <span class="stringliteral">""</span>;
00401     GtkTreeIter         iter;
00402     GtkCellRenderer     *renderer;
00403      
00404     window = gtk_vbox_new (FALSE, 6);     
00405     gtk_container_set_border_width (GTK_CONTAINER(window), 12);
00406 
00407     hbox = gtk_hbox_new (FALSE, 12);
00408     gtk_box_pack_start (GTK_BOX(window), hbox, FALSE, FALSE, 0);
00409 
00410     vbox = gtk_vbox_new (FALSE, 0);
00411     gtk_box_pack_start (GTK_BOX (hbox), vbox, FALSE, FALSE, 0);
00412 <span class="comment">/*</span>
00413 <span class="comment">    interface.drawing_area = gtk_drawing_area_new ();</span>
00414 <span class="comment">    gtk_box_pack_start (GTK_BOX (vbox), interface.drawing_area, TRUE, FALSE, 0);</span>
00415 <span class="comment"></span>
00416 <span class="comment">    gtk_drawing_area_size (GTK_DRAWING_AREA (interface.drawing_area),</span>
00417 <span class="comment">                          DEFAULT_ANIMATION_WIDTH,</span>
00418 <span class="comment">                        DEFAULT_ANIMATION_HEIGHT);</span>
00419 <span class="comment">                    </span>
00420 <span class="comment">    gtk_drag_source_set (interface.drawing_area, </span>
00421 <span class="comment">                      GDK_BUTTON1_MASK,</span>
00422 <span class="comment">                      drag_types, </span>
00423 <span class="comment">                      G_N_ELEMENTS (drag_types), </span>
00424 <span class="comment">                      GDK_ACTION_COPY);</span>
00425 <span class="comment">                      </span>
00426 <span class="comment">    gtk_drag_source_set_icon_stock (interface.drawing_area,</span>
00427 <span class="comment">                                   GTK_STOCK_FIND);</span>
00428 <span class="comment">                    </span>
00429 <span class="comment">    g_signal_connect (G_OBJECT (interface.drawing_area), </span>
00430 <span class="comment">                    "drag_data_get",</span>
00431 <span class="comment">                    G_CALLBACK (drag_data_animation_cb), </span>
00432 <span class="comment">                    interface.main_window);</span>
00433 <span class="comment"></span>
00434 <span class="comment">    g_signal_connect (interface.drawing_area, "expose-event",</span>
00435 <span class="comment">                    G_CALLBACK (animation_expose_event_cb), NULL);</span>
00436 <span class="comment">*/</span>     
00437 
00438     interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a> = gtk_table_new (3, 1, FALSE);
00439     gtk_table_set_row_spacings (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>), 6);
00440     gtk_table_set_col_spacings (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>), 12);
00441     gtk_container_add (GTK_CONTAINER(hbox), interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>);
00442 
00443   <span class="comment">/*completion_model*/</span>
00444 
00445    <a class="code" href="search__file_8c.html#a0">completion_model</a> = gtk_list_store_new (2, 
00446                                   G_TYPE_STRING,
00447                                   G_TYPE_STRING);
00448 
00449     interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a> = gtk_entry_new (); 
00450     entry_completion = gtk_entry_completion_new ();  
00451     gtk_entry_set_completion( GTK_ENTRY(interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>), entry_completion);
00452     gtk_entry_completion_set_model (entry_completion, GTK_TREE_MODEL(<a class="code" href="search__file_8c.html#a0">completion_model</a>));
00453    
00454     <span class="comment">/* gtk_entry_completion_set_text_column (entry_completion, 0);   </span>
00455 <span class="comment">     * Default minimum length of entry before completion func gets activated is 1</span>
00456 <span class="comment">     * printf("key length %i\n", gtk_entry_completion_get_minimum_key_length(entry_completion));</span>
00457 <span class="comment">     */</span>
00458      
00459     label = gtk_label_new_with_mnemonic (_(<span class="stringliteral">"_Search for Parts:"</span>)); 
00460     gtk_label_set_justify (GTK_LABEL(label), GTK_JUSTIFY_LEFT);
00461     g_object_set (G_OBJECT(label), <span class="stringliteral">"xalign"</span>, 0.0, NULL);
00462     gtk_label_set_mnemonic_widget (GTK_LABEL(label), interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>);
00463     gtk_table_attach (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>), interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>, 0, 1, 0, 1, GTK_EXPAND | GTK_FILL | GTK_SHRINK, 0, 0, 0);
00464     
00465     interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a> = gtk_button_new_from_stock (GTK_STOCK_FIND);
00466     gtk_button_set_label(GTK_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>), _(<span class="stringliteral">"Mark"</span>));
00467     gtk_table_attach (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>), interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, 1, 2, 0, 1, GTK_FILL | GTK_SHRINK, 0, 0, 0);
00468     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>),<span class="stringliteral">"clicked"</span>,
00469                     G_CALLBACK(<a class="code" href="search__gui_8c.html#a15">click_find_cb</a>), NULL);
00470         
00471     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, TRUE);
00472     gtk_button_set_focus_on_click(GTK_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>), FALSE);
00473 
00474     hbox = gtk_hbox_new (FALSE, 12);
00475     gtk_box_pack_start (GTK_BOX(window), hbox, FALSE, FALSE, 0);
00476 
00477     interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a> = gtk_check_button_new_with_mnemonic (_(<span class="stringliteral">"Designator"</span>));
00478     gtk_box_pack_start (GTK_BOX(hbox), interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>, FALSE, FALSE, 0);
00479     g_signal_connect (G_OBJECT (interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>),<span class="stringliteral">"clicked"</span>,
00480                     G_CALLBACK (click_check_button_cb), (<span class="keywordtype">void</span>*)COLUMN_DESIGNATOR);
00481                           
00482     interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a> = gtk_button_new_from_stock (GTK_STOCK_FIND);
00483     gtk_button_set_label(GTK_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a>), _(<span class="stringliteral">"Invert Selection"</span>));
00484     gtk_table_attach (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>),interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a>, 0, 1, 1, 2, GTK_SHRINK, 0, 0, 0);
00485     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a>),<span class="stringliteral">"clicked"</span>,
00486                     G_CALLBACK(click_invert_selection_cb), NULL);
00487                       
00488     interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a> = gtk_button_new_from_stock (GTK_STOCK_FIND);
00489     gtk_button_set_label(GTK_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a>), _(<span class="stringliteral">"Top Parts"</span>));
00490     gtk_table_attach (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>),interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a>, 1, 2, 1, 2,  GTK_SHRINK, 0, 0, 0);
00491     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a>),<span class="stringliteral">"clicked"</span>,
00492                     G_CALLBACK(click_top_parts_selection_cb), NULL); 
00493                       
00494     interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a> = gtk_button_new_from_stock (GTK_STOCK_FIND);
00495     gtk_button_set_label(GTK_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a>), _(<span class="stringliteral">"Bottom Parts"</span>));
00496     gtk_table_attach (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>),interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a>, 2, 3, 1, 2,  GTK_SHRINK, 0, 0, 0);
00497     g_signal_connect (G_OBJECT(interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a>),<span class="stringliteral">"clicked"</span>,
00498                     G_CALLBACK(click_bottom_parts_selection_cb), NULL);                                                                                                                                           
00499      
00500     combo_box_model = gtk_list_store_new (2, G_TYPE_INT, G_TYPE_STRING); 
00501     interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a> = gtk_combo_box_new_with_model(GTK_TREE_MODEL(combo_box_model));
00502     
00503     <span class="keywordflow">for</span> (idx =  0; idx &lt; MAX_FILES; idx++) {
00504 
00505         <span class="keywordflow">if</span> ((<a class="code" href="gerbv_8c.html#a0">screen</a>.file[idx] == NULL)) {
00506             gtk_list_store_append(combo_box_model, &amp;iter);
00507             gtk_list_store_set (combo_box_model, &amp;iter, 0, idx, -1);
00508         } 
00509     }
00510 
00511     renderer = gtk_cell_renderer_text_new ();
00512     gtk_cell_layout_pack_start (GTK_CELL_LAYOUT(GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>)), renderer, TRUE);
00513     gtk_cell_layout_add_attribute (GTK_CELL_LAYOUT(GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>)), renderer, <span class="stringliteral">"text"</span>, 0);  
00514       
00515 
00516     
00517     gtk_table_attach (GTK_TABLE(interface.<a class="code" href="struct__InterfaceStruct.html#o3">table</a>),interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>, 2, 3, 0, 1, GTK_SHRINK, 0, 0, 0);
00518     g_signal_connect (G_OBJECT((GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>))),<span class="stringliteral">"changed"</span>,
00519                     G_CALLBACK(click_layer_active_cb), NULL);  
00520 
00521     sprintf(s_MAX_FILES,<span class="stringliteral">"%i"</span>,MAX_FILES-2);
00522     gtk_tree_model_get_iter_from_string(GTK_TREE_MODEL(combo_box_model), &amp;iter, s_MAX_FILES);
00523     gtk_combo_box_set_active_iter   (GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>), &amp;iter);
00524     g_signal_emit_by_name ((GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>)), <span class="stringliteral">"changed"</span>);
00525     <span class="comment">/*click_layer_active_cb(GTK_WIDGET(interface.layer_active), NULL);*/</span>
00526      
00527                                                                                             
00528             
00529     interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a> = gtk_check_button_new_with_mnemonic (_(<span class="stringliteral">"Comment"</span>));
00530     gtk_box_pack_end (GTK_BOX(hbox), interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a>, FALSE, FALSE, 0);
00531     g_signal_connect (G_OBJECT (interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a>),<span class="stringliteral">"clicked"</span>,
00532                     G_CALLBACK (click_check_button_cb), (<span class="keywordtype">void</span>*) COLUMN_COMMENT);
00533     g_signal_connect (G_OBJECT (interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>), <span class="stringliteral">"key_press_event"</span>,
00534                     G_CALLBACK (<a class="code" href="search__gui_8c.html#a17">file_is_named_entry_key_press_cb</a>),
00535                     NULL);
00536     g_signal_connect (G_OBJECT (interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>), <span class="stringliteral">"activate"</span>,
00537                     G_CALLBACK (file_is_named_activate_cb),
00538                     NULL);
00539                 
00540     gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a>, <span class="stringliteral">"Invert current selection"</span>, NULL);
00541     gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>, <span class="stringliteral">"Search for Designator &lt;Default&gt;"</span>, NULL);
00542     gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a>, <span class="stringliteral">"Select parts on the top side"</span>, NULL);
00543     gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a>, <span class="stringliteral">"Select parts on the bottom side"</span>, NULL);
00544     gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a>, <span class="stringliteral">"Search in Comments"</span>, NULL);
00545 <span class="preprocessor">#ifdef HAVE_REGEX_H</span>
00546 <span class="preprocessor"></span>    gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>, <span class="stringliteral">"Enter a part name to search for;\nUse .* (regex) as a wildcard"</span>, NULL);
00547 <span class="preprocessor">#else</span>
00548 <span class="preprocessor"></span>    gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>, <span class="stringliteral">"Enter a part name to search for, press Enter to mark"</span>, NULL);
00549 <span class="preprocessor">#endif</span>
00550 <span class="preprocessor"></span>    gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, <span class="stringliteral">"Mark search results on screen"</span>, NULL); 
00551     gtk_tooltips_set_tip(tooltips, interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>, <span class="stringliteral">"Choose layer for selection"</span>, NULL);    
00552     
00553     vbox = gtk_vbox_new (FALSE, 12);
00554     gtk_box_pack_start (GTK_BOX (window), vbox, TRUE, TRUE, 0);
00555     
00556     interface.<a class="code" href="struct__InterfaceStruct.html#o12">results</a> = <a class="code" href="search__gui_8c.html#a6">create_search_results_section</a> ();
00557            
00558     gtk_box_pack_start (GTK_BOX (vbox), interface.<a class="code" href="struct__InterfaceStruct.html#o12">results</a>, TRUE, TRUE, 0);
00559     
00560     gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>), TRUE);
00561     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o12">results</a>, TRUE);
00562     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, TRUE);
00563     <span class="keywordflow">return</span> window;
00564 } <span class="comment">/* create_main_search_window */</span>
00565 
00567 <span class="keywordtype">void</span>
<a name="l00568"></a><a class="code" href="search__gui_8c.html#a8">00568</a> <a class="code" href="search__gui_8c.html#a8">create_search_window</a>(GtkWidget *widget, gpointer data)
00569 {
00570     GtkWidget    *window;
00571    
00572     <span class="keywordflow">if</span> (interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a> != NULL) {
00573         gtk_widget_destroy(interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>);
00574         <a class="code" href="search_8c.html#a4">free_pnp_state</a>(parsed_PNP_data);
00575     }  
00576     memset (&amp;interface, 0, <span class="keyword">sizeof</span> (interface));
00577     interface.<a class="code" href="struct__InterfaceStruct.html#o14">geometry</a>.min_height = MINIMUM_WINDOW_HEIGHT;
00578     interface.<a class="code" href="struct__InterfaceStruct.html#o14">geometry</a>.min_width  = MINIMUM_WINDOW_WIDTH;
00579    
00580     interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a> = gtk_window_new (GTK_WINDOW_TOPLEVEL);
00581 
00582     window = <a class="code" href="search__gui_8c.html#a7">create_main_search_window</a> ();
00583     gtk_container_add(GTK_CONTAINER(interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>), window);
00584  
00585     gtk_window_set_focus (GTK_WINDOW(interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>), 
00586            interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>);
00587     gtk_window_set_title(GTK_WINDOW(interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>),
00588             _(<span class="stringliteral">"Select parts"</span>));
00589 
00590     GTK_WIDGET_SET_FLAGS (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, GTK_CAN_DEFAULT);
00591     gtk_window_set_default (GTK_WINDOW(interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>), interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>); 
00592 
00593     gtk_widget_show_all (window);
00594 
00595     gtk_widget_show (interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>);
00596     
00597     g_signal_connect (G_OBJECT (interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>),<span class="stringliteral">"delete-event"</span>,
00598                     G_CALLBACK (gtk_widget_hide_on_delete), interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>);
00599 
00600     <span class="keywordflow">return</span>;
00601 } <span class="comment">/* create_search_window */</span>
00602 
00603 
00606 <span class="keywordtype">void</span>
<a name="l00607"></a><a class="code" href="search__gui_8c.html#a9">00607</a> <a class="code" href="search__gui_8c.html#a9">update_combo_box_model</a>(<span class="keywordtype">void</span>)
00608 {
00609    <span class="keywordtype">int</span>         idx0;
00610    GtkTreeIter iter;
00611         
00612         <span class="keywordflow">if</span> (!combo_box_model) {
00613             combo_box_model = gtk_list_store_new (2, G_TYPE_INT, G_TYPE_STRING); 
00614         } <span class="keywordflow">else</span> {
00615             gtk_list_store_clear (combo_box_model);
00616         }            
00617    
00618         <span class="keywordflow">for</span> (idx0 =  0; idx0 &lt; MAX_FILES; idx0++) {
00619 
00620 <span class="comment">/*FIX ME LayER management &amp;&amp; (interface.layer_select_active != idx0) */</span>
00621             <span class="keywordflow">if</span> ((<a class="code" href="gerbv_8c.html#a0">screen</a>.file[idx0] == NULL) ) {
00622                 gtk_list_store_append(combo_box_model, &amp;iter);
00623                 gtk_list_store_set (combo_box_model, &amp;iter, 0, idx0, -1);
00624             } 
00625         }
00626         gtk_combo_box_set_model(GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>), GTK_TREE_MODEL(combo_box_model));
00627         <span class="keywordflow">if</span> (<a class="code" href="gerbv_8c.html#a0">screen</a>.curr_index == interface.<a class="code" href="struct__InterfaceStruct.html#o16">layer_select_active</a>) {
00628             gtk_tree_model_get_iter_first(GTK_TREE_MODEL(combo_box_model), &amp;iter);
00629             g_signal_emit_by_name ((GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>)), <span class="stringliteral">"changed"</span>);
00630             gtk_combo_box_set_active_iter   (GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>), &amp;iter);
00631             click_layer_active_cb(GTK_WIDGET(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>), NULL);
00632         }
00633 }<span class="comment">/*update_combo_box_model*/</span>
00634 
00635 <span class="keywordtype">void</span>
00636 click_check_button_cb (GtkWidget   *widget, 
00637                             gpointer      data)
00638 {   gboolean     designator_active, comment_active; 
00639     
00640     designator_active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>));
00641     comment_active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a>));
00642     
00643     <span class="keywordflow">if</span> (designator_active) {
00644         entry_completion = gtk_entry_completion_new ();  
00645         gtk_entry_set_completion( GTK_ENTRY(interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>), entry_completion);
00646         gtk_entry_completion_set_model (entry_completion, GTK_TREE_MODEL(completion_model));
00647         gtk_entry_completion_set_text_column (entry_completion, 0); 
00648     } <span class="keywordflow">else</span>  {
00649         entry_completion = gtk_entry_completion_new ();  
00650         gtk_entry_set_completion( GTK_ENTRY(interface.<a class="code" href="struct__InterfaceStruct.html#o0">file_is_named_entry</a>), entry_completion);
00651         gtk_entry_completion_set_model (entry_completion, GTK_TREE_MODEL(completion_model));
00652         gtk_entry_completion_set_text_column (entry_completion, 1); 
00653     }
00654 } <span class="comment">/* click_check_button_cb */</span>
00655 
00656 <span class="keywordtype">void</span>
00657 click_invert_selection_cb(GtkWidget       *widget,
00658                               gpointer *data)
00659 {
00660 
00661     GtkTreeIter iter;
00662     GtkTreeSelection *tree_sel;
00663 
00664     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a>, FALSE);
00665     <span class="keywordflow">if</span>(!gtk_tree_model_get_iter_first (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter)) {
00666       GERB_MESSAGE(<span class="stringliteral">"empty interface.model\n"</span>);
00667     }
00668     tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
00669     <span class="keywordflow">do</span> {
00670     <span class="comment">/* We loop through the current selection inverting </span>
00671 <span class="comment">     * all selections </span>
00672 <span class="comment">     */</span>
00673        <span class="keywordflow">if</span> (gtk_tree_selection_iter_is_selected(tree_sel,&amp;iter)) {
00674           gtk_tree_selection_unselect_iter(tree_sel, &amp;iter);
00675        } <span class="keywordflow">else</span> 
00676        <span class="keywordflow">if</span> (!gtk_tree_selection_iter_is_selected(tree_sel,&amp;iter)) {
00677                gtk_tree_selection_select_iter(tree_sel, &amp;iter);
00678        }
00679     } <span class="keywordflow">while</span> (gtk_tree_model_iter_next(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter));
00680    
00681     <span class="comment">//g_free(tree_sel);    </span>
00682     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o7">invert_selection</a>, TRUE);
00683 
00684 } <span class="comment">/* click_invert_selection_cb */</span>
00685 
00686 
00687 <span class="keywordtype">void</span>
00688 click_bottom_parts_selection_cb(GtkWidget *widget,
00689                               gpointer *data)
00690 {
00691 
00692     GtkTreeIter      iter;
00693     GtkTreeSelection *tree_sel;
00694     <span class="keywordtype">char</span>             *layer;
00695     <span class="keywordtype">int</span>              none_selected = 0;
00696 
00697     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a>, FALSE);
00698     <span class="keywordflow">if</span>(!gtk_tree_model_get_iter_first (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter)) {
00699       GERB_MESSAGE(<span class="stringliteral">"empty interface.model\n"</span>);
00700     }
00701     tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
00702     <span class="keywordflow">if</span> (gtk_tree_selection_count_selected_rows(tree_sel) &gt; 0) 
00703         none_selected = 0;
00704     <span class="keywordflow">else</span> {
00705         <span class="keywordflow">if</span> (gtk_tree_selection_count_selected_rows(tree_sel) == 0)
00706         none_selected = 1;
00707         }
00708     <span class="keywordflow">do</span> {
00709     <span class="comment">/* We loop through the current selection checking if layer is T or B </span>
00710 <span class="comment">     * </span>
00711 <span class="comment">     */</span>
00712 
00713     gtk_tree_model_get(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter,  COLUMN_LAYER, &amp;layer, -1);
00714     <span class="keywordflow">if</span> (none_selected) {
00715         <span class="keywordflow">if</span> (strchr(layer,<span class="charliteral">'T'</span>))  
00716             gtk_tree_selection_unselect_iter(tree_sel, &amp;iter);
00717         <span class="keywordflow">else</span> <span class="keywordflow">if</span>  (strchr(layer,<span class="charliteral">'B'</span>))         
00718             gtk_tree_selection_select_iter(tree_sel, &amp;iter);
00719         <span class="keywordflow">else</span>
00720             GERB_MESSAGE(<span class="stringliteral">"No layer information in this line"</span>);
00721     } <span class="keywordflow">else</span> {
00722              <span class="keywordflow">if</span> (gtk_tree_selection_iter_is_selected(tree_sel,&amp;iter) &amp;&amp; (strchr(layer,<span class="charliteral">'T'</span>)))
00723                  gtk_tree_selection_unselect_iter(tree_sel, &amp;iter); 
00724                  <span class="comment">/*takes out all of current selection which are on top side*/</span>
00725     }           
00726     } <span class="keywordflow">while</span> (gtk_tree_model_iter_next(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter));
00727    
00728     <span class="comment">//g_free(tree_sel);    </span>
00729     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o9">bottom_parts_selection</a>, TRUE);
00730 
00731 } <span class="comment">/* click_bottom_parts_selection_cb */</span>
00732 
00733 
00734 
00735 <span class="keywordtype">void</span>
00736 click_top_parts_selection_cb(GtkWidget    *widget,
00737                               gpointer *data)
00738 {
00739 
00740     GtkTreeIter      iter;
00741     GtkTreeSelection *tree_sel;
00742     <span class="keywordtype">char</span>             *layer;
00743     <span class="keywordtype">int</span>              none_selected = 0;
00744     
00745     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a>, FALSE);
00746  
00747     <span class="keywordflow">if</span>(!gtk_tree_model_get_iter_first (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter)) {
00748       GERB_MESSAGE(<span class="stringliteral">"empty interface.model\n"</span>);
00749     }
00750     tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
00751      <span class="keywordflow">if</span> (gtk_tree_selection_count_selected_rows(tree_sel) &gt; 0) 
00752         none_selected = 0;
00753     <span class="keywordflow">else</span> {
00754         <span class="keywordflow">if</span> (gtk_tree_selection_count_selected_rows(tree_sel) == 0)
00755         none_selected = 1;
00756         }
00757     <span class="keywordflow">do</span> {
00758     <span class="comment">/* We loop through the current selection checking if layer is T or B </span>
00759 <span class="comment">     * </span>
00760 <span class="comment">     */</span>
00761 
00762     gtk_tree_model_get(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter,  COLUMN_LAYER, &amp;layer, -1);
00763 
00764     <span class="keywordflow">if</span> (none_selected) {
00765         <span class="keywordflow">if</span> (strchr(layer,<span class="charliteral">'B'</span>))  
00766             gtk_tree_selection_unselect_iter(tree_sel, &amp;iter);
00767         <span class="keywordflow">else</span> <span class="keywordflow">if</span>  (strchr(layer,<span class="charliteral">'T'</span>))         
00768             gtk_tree_selection_select_iter(tree_sel, &amp;iter);
00769         <span class="keywordflow">else</span>
00770             GERB_MESSAGE(<span class="stringliteral">"No layer information in this line"</span>);
00771     } <span class="keywordflow">else</span> {
00772              <span class="keywordflow">if</span> (gtk_tree_selection_iter_is_selected(tree_sel,&amp;iter) &amp;&amp; (strchr(layer,<span class="charliteral">'B'</span>)))
00773                  gtk_tree_selection_unselect_iter(tree_sel, &amp;iter); 
00774                  <span class="comment">/*takes out all of current selection which are on bottom side*/</span>
00775     }           
00776     } <span class="keywordflow">while</span> (gtk_tree_model_iter_next(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter));   
00777     <span class="comment">//g_free(tree_sel);    </span>
00778     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o8">top_parts_selection</a>, TRUE);
00779 
00780 } <span class="comment">/* click_top_parts_selection_cb */</span>
00781 
00782 <span class="keywordtype">void</span>
00783 click_layer_active_cb(GtkWidget    *widget,
00784                               gpointer *data)
00785 {
00786 
00787     <span class="keywordtype">int</span>           idx;
00788     GtkTreeIter   iter;
00789    
00790     <span class="keywordflow">if</span> (gtk_tree_model_get_iter_first (GTK_TREE_MODEL(combo_box_model), &amp;iter)) {
00791         gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>, FALSE);
00792         gtk_combo_box_get_active_iter(GTK_COMBO_BOX(interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>), &amp;iter);
00793         gtk_tree_model_get (GTK_TREE_MODEL(combo_box_model), &amp;iter, 0, &amp;idx, -1);
00794         interface.<a class="code" href="struct__InterfaceStruct.html#o16">layer_select_active</a> = idx;
00795         gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o15">layer_active</a>, TRUE);
00796     }
00797     
00798 
00799 } <span class="comment">/* click_layer_active_cb */</span>
00800    
00801 
00802 <span class="keywordtype">void</span>
<a name="l00803"></a><a class="code" href="search__gui_8c.html#a15">00803</a> <a class="code" href="search__gui_8c.html#a15">click_find_cb</a> (GtkWidget    *widget, 
00804               gpointer      data)
00805 {
00806 
00807     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, FALSE);
00808 
00809     <a class="code" href="search__mark_8c.html#a0">create_marked_layer</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o16">layer_select_active</a>);
00810     
00811         <span class="comment">/* Redraw the image(s) */</span>
00812   
00813     redraw_pixmap(<a class="code" href="gerbv_8c.html#a0">screen</a>.drawing_area, TRUE);
00814            
00815     gtk_widget_set_sensitive (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, TRUE);
00816 } <span class="comment">/* click_find_cb */</span>
00817 
00818 
00819 
00820 <span class="keywordtype">void</span>
00821 file_is_named_activate_cb (GtkWidget      *widget, 
00822                         gpointer   data)
00823 {
00824       <span class="keywordflow">if</span> ((GTK_WIDGET_VISIBLE (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>)) &amp;&amp; 
00825        (GTK_WIDGET_SENSITIVE (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>))) {
00826            <a class="code" href="search__gui_8c.html#a15">click_find_cb</a> (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
00827       }
00828 } <span class="comment">/* file_is_named_activate_cb */</span>
00829 
00830 
00832 gboolean
<a name="l00833"></a><a class="code" href="search__gui_8c.html#a17">00833</a> <a class="code" href="search__gui_8c.html#a17">file_is_named_entry_key_press_cb</a> (GtkWidget      *widget, 
00834                           GdkEventKey     *event, 
00835                           gpointer               data)   
00836 { 
00837 
00838     g_return_val_if_fail (GTK_IS_WIDGET(widget), FALSE);
00839     <span class="keywordflow">if</span> (event-&gt;keyval == GDK_Escape)    {
00840         GERB_MESSAGE(<span class="stringliteral">"ESC unselected all\n"</span>);
00841         gtk_tree_selection_unselect_all (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)));
00842     }  <span class="keywordflow">else</span> <span class="keywordflow">if</span>  (event-&gt;keyval == GDK_Return) {  
00843         <span class="keywordflow">if</span> ((GTK_WIDGET_VISIBLE (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>)) &amp;&amp; 
00844            (GTK_WIDGET_SENSITIVE (interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>))) {
00845             <a class="code" href="search__gui_8c.html#a5">select_by_regex</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
00846            
00847        }
00848     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((event-&gt;keyval) &amp;&amp; (event-&gt;keyval != GDK_Shift_L) 
00849               &amp;&amp; (event-&gt;keyval != GDK_Shift_R) &amp;&amp; (event-&gt;keyval != GDK_Return)) {
00850         GtkTreeIter          iter;
00851         GtkTreePath         *path;
00852         <span class="keywordtype">int</span>                  scroll_line_number = 1, not_found = 1; 
00853         <span class="keywordtype">char</span>                *tmp_entry;
00854         <span class="keywordtype">char</span>                 entered_key[MAXL], path_string[MAXL];
00855         gboolean             designator_active = FALSE, comment_active = FALSE;
00856          
00857         <span class="keywordflow">if</span>  (event-&gt;keyval == GDK_BackSpace) {
00858            <span class="comment">/*CHECK ME also scroll on hitting backspace?*/</span>
00859             <span class="keywordflow">if</span> (strlen(composed_entry)&gt;1) {
00860                 composed_entry[strlen(composed_entry)-1] = <span class="charliteral">'\0'</span>;<span class="comment">/*we shorten our composed string by one*/</span>
00861             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strlen(composed_entry) == 1) {
00862                 strncpy(composed_entry, <span class="stringliteral">""</span>, 1);
00863             }
00864         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;keyval != GDK_Return) {
00865             designator_active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>));
00866             comment_active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o10">check_comment</a>));
00867             sprintf(entered_key, <span class="stringliteral">"%c"</span>, event-&gt;keyval);
00868             strncat(composed_entry, entered_key, 1);
00869 
00870             <span class="keywordflow">if</span>(!gtk_tree_model_get_iter_first (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter)) {
00871               GERB_MESSAGE(<span class="stringliteral">"empty interface.model\n"</span>);
00872               <span class="keywordflow">return</span> TRUE;
00873             }
00874             <span class="keywordflow">do</span> {
00875                <span class="comment">/* Scroll Engine:</span>
00876 <span class="comment">                * We loop through the treemodel, as soon we found the first which is matching the key </span>
00877 <span class="comment">                * pressed we exit and scroll there</span>
00878 <span class="comment">                */</span>
00879                 scroll_line_number++;
00880                 <span class="keywordflow">if</span> (((!designator_active) &amp;&amp; (!comment_active)) || ((designator_active) &amp;&amp; (!comment_active))) {
00881                     gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON(interface.<a class="code" href="struct__InterfaceStruct.html#o6">check_designator</a>), TRUE);  
00882                     gtk_tree_model_get (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter, COLUMN_DESIGNATOR, &amp;tmp_entry , -1); 
00883                     <span class="keywordflow">if</span> (strncasecmp(composed_entry, tmp_entry, strlen(composed_entry)) == 0) {
00884                         sprintf(path_string, <span class="stringliteral">"%i"</span>, scroll_line_number);
00885                         path = gtk_tree_path_new_from_string (path_string);
00886                         gtk_tree_view_scroll_to_cell(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), path, COLUMN_DESIGNATOR, TRUE, 0.3, 0.5); 
00887                         not_found = 0;
00888                     }
00889                 } 
00890 <span class="preprocessor">#if 0</span>
00891 <span class="preprocessor"></span>          <span class="comment">/* using strncasecomp with the utf8 set does not seem to work so scrolling to </span>
00892 <span class="comment">           * comment entries is deactivated for the moment */</span>
00893                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!designator_active) &amp;&amp; (comment_active)) {
00894                 <span class="comment">//  printf("comment active");</span>
00895                     gtk_tree_model_get (GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter, COLUMN_COMMENT, &amp;tmp_entry , -1); 
00896                     sprintf(entered_key, <span class="stringliteral">"%c"</span>, event-&gt;keyval);
00897 
00898                     <span class="keywordflow">if</span> (strncasecmp(composed_entry, tmp_entry, strlen(composed_entry)) == 0) {
00899       <span class="comment">//                printf("This:%c compared to:%s and this %s\n", event-&gt;keyval, tmp_entry, entered_key);</span>
00900   
00901                         sprintf(path_string, <span class="stringliteral">"%i"</span>, scroll_line_number);
00902                      <span class="comment">// printf("%d linnumber:%d new path:%s\n", scroll_line_number, tmp_line_number, path_string);</span>
00903                         path = gtk_tree_path_new_from_string (path_string);
00904                         gtk_tree_view_scroll_to_cell(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), path, COLUMN_COMMENT, TRUE, 0.3, 0.5); 
00905                         not_found = 0;
00906                     }
00907                 }
00908 <span class="preprocessor">#endif              </span>
00909 <span class="preprocessor"></span>            } <span class="keywordflow">while</span> (gtk_tree_model_iter_next(GTK_TREE_MODEL(interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>), &amp;iter) &amp;&amp; not_found);               
00910         }  
00911   }
00912    <span class="keywordflow">return</span> FALSE;
00913       
00914 } <span class="comment">/* file_is_named_entry_key_press_cb */</span>
00915 
00916 gboolean row_selected_by_button_press_event = FALSE;
00917 
00918 
00920 gboolean
<a name="l00921"></a><a class="code" href="search__gui_8c.html#a18">00921</a> <a class="code" href="search__gui_8c.html#a18">file_event_after_cb</a>          (GtkWidget   *widget,
00922                                         GdkEventButton *event,
00923                                         gpointer        data)
00924 {
00925 
00926 <span class="keywordflow">if</span> (event-&gt;type == GDK_2BUTTON_PRESS) {   
00927       GtkTreePath *path;
00928 
00929         <span class="keywordflow">if</span> (gtk_tree_view_get_path_at_pos (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), event-&gt;x, event-&gt;y,
00930               &amp;path, NULL, NULL, NULL)) {
00931 
00932                 gtk_tree_selection_unselect_all (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)));
00933                 gtk_tree_selection_select_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
00934                 <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
00935            }
00936        gtk_tree_path_free (path);
00937         
00938     } 
00939     <span class="keywordflow">return</span> !(row_selected_by_button_press_event);
00940 }<span class="comment">/*file_event_after_cb*/</span>                            
00941 
00942 
00943 gboolean
00944 file_button_press_event_cb (GtkWidget            *widget, 
00945                          GdkEventButton   *event, 
00946                          gpointer         data)
00947 {
00948     GtkTreePath *path;
00949     row_selected_by_button_press_event = TRUE;
00950 
00951     <span class="keywordflow">if</span> (event-&gt;window != gtk_tree_view_get_bin_window (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>))) {
00952            <span class="keywordflow">return</span> FALSE;
00953     }
00954      
00955 
00956     <span class="keywordflow">if</span> (gtk_tree_view_get_path_at_pos (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), event-&gt;x, event-&gt;y,
00957     &amp;path, NULL, NULL, NULL)) {
00958 
00959         <span class="keywordflow">if</span> ((event-&gt;button == 1 || event-&gt;button == 2 || event-&gt;button == 3)
00960             &amp;&amp; gtk_tree_selection_path_is_selected 
00961                (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path)) {
00962 
00963             row_selected_by_button_press_event = FALSE;
00964         }
00965 
00966         gtk_tree_path_free (path);
00967     } <span class="keywordflow">else</span> {
00968         gtk_tree_selection_unselect_all (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)));
00969     }
00970    
00971     <span class="keywordflow">return</span> !(row_selected_by_button_press_event);
00972     
00973      
00974 } <span class="comment">/* file_button_press_event_cb */</span>
00975 
00976 
00977 
00978 gboolean
00979 file_button_release_event_cb (GtkWidget   *widget, 
00980                            GdkEventButton        *event, 
00981                            gpointer              data)
00982 {
00983 
00984     <span class="keywordflow">if</span> (event-&gt;window != gtk_tree_view_get_bin_window (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>))) {
00985            <span class="keywordflow">return</span> FALSE;
00986     }
00987        
00988     <span class="keywordflow">if</span> (gtk_tree_selection_count_selected_rows (GTK_TREE_SELECTION(interface.<a class="code" href="struct__InterfaceStruct.html#o19">selection</a>)) == 0) {
00989        <span class="keywordflow">return</span> FALSE;
00990     }
00991     <span class="keywordflow">if</span> (event-&gt;button == 3) {      
00992       GtkTreePath *path;
00993 
00994         <span class="keywordflow">if</span> (gtk_tree_view_get_path_at_pos (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), event-&gt;x, event-&gt;y,
00995               &amp;path, NULL, NULL, NULL)) {
00996 
00997                   <span class="keywordflow">if</span> ((event-&gt;state &amp; GDK_SHIFT_MASK) || (event-&gt;state &amp; GDK_CONTROL_MASK)) {
00998                       <span class="keywordflow">if</span> (row_selected_by_button_press_event) {
00999                     gtk_tree_selection_select_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
01000                     <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01001                       } <span class="keywordflow">else</span> {
01002                     gtk_tree_selection_unselect_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
01003                     <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01004                       }
01005             } <span class="keywordflow">else</span> {
01006                 gtk_tree_selection_unselect_all (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)));
01007                 gtk_tree_selection_select_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
01008                 <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01009                   }
01010        gtk_tree_path_free (path);
01011         }
01012     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;button == 1 || event-&gt;button == 2) {
01013            GtkTreePath *path;
01014 
01015            <span class="keywordflow">if</span> (gtk_tree_view_get_path_at_pos (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>), event-&gt;x, event-&gt;y,
01016                   &amp;path, NULL, NULL, NULL)) {
01017                   <span class="keywordflow">if</span> ((event-&gt;state &amp; GDK_SHIFT_MASK) || (event-&gt;state &amp; GDK_CONTROL_MASK)) {
01018                       <span class="keywordflow">if</span> (row_selected_by_button_press_event) {
01019                     gtk_tree_selection_select_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
01020                       } <span class="keywordflow">else</span> {
01021                     gtk_tree_selection_unselect_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
01022                       }
01023             } <span class="keywordflow">else</span> {
01024                    gtk_tree_selection_unselect_all (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)));
01025                 gtk_tree_selection_select_path (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)), path);
01026                   }
01027            }  
01028        gtk_tree_path_free (path);
01029     }  
01030     <span class="keywordflow">return</span> FALSE;
01031 } <span class="comment">/* file_button_release_event_cb */</span>
01032 
01033 
01034 
01035 <span class="comment">/*void  </span>
01036 <span class="comment">drag_begin_file_cb  (GtkWidget          *widget,</span>
01037 <span class="comment">                   GdkDragContext     *context,</span>
01038 <span class="comment">                   GtkSelectionData   *selection_data,</span>
01039 <span class="comment">                   guint               info,</span>
01040 <span class="comment">                   guint               time,</span>
01041 <span class="comment">                   gpointer            data)</span>
01042 <span class="comment">{      </span>
01043 <span class="comment">    if (gtk_tree_selection_count_selected_rows (GTK_TREE_SELECTION(interface.selection)) &gt; 1) {</span>
01044 <span class="comment">           gtk_drag_set_icon_stock (context, GTK_STOCK_DND_MULTIPLE, 0, 0);</span>
01045 <span class="comment">    }</span>
01046 <span class="comment">    else {</span>
01047 <span class="comment">           gtk_drag_set_icon_stock (context, GTK_STOCK_DND, 0, 0);</span>
01048 <span class="comment">    }</span>
01049 <span class="comment">}</span>
01050 <span class="comment">*/</span>
01051 
01053 gboolean
<a name="l01054"></a><a class="code" href="search__gui_8c.html#a21">01054</a> <a class="code" href="search__gui_8c.html#a21">file_key_press_event_cb</a>  (GtkWidget              *widget, 
01055                        GdkEventKey        *event, 
01056                        gpointer           data)
01057 {             
01058     
01059     <span class="keywordflow">if</span> (event-&gt;keyval == GDK_Escape) {
01060         GERB_MESSAGE(<span class="stringliteral">"ESC unselected all\n"</span>);<span class="comment">/*CHECK ME: do we need to check GTK_WIDGET_VISIBLE?*/</span>
01061         gtk_tree_selection_unselect_all (gtk_tree_view_get_selection (GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>)));
01062     
01063      } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (event-&gt;state &amp; GDK_SHIFT_MASK) {
01064                                                    <span class="comment">/*select multiple items by SHift-Up/Down*/</span>
01065         <span class="keywordflow">if</span> (event-&gt;keyval == GDK_Up)  {
01066     
01067         GtkTreeSelection  *tree_sel = NULL;    
01068         GList             *selection_list, *tmp_path;
01069                 
01070         
01071         tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
01072         selection_list = gtk_tree_selection_get_selected_rows
01073                                             (GTK_TREE_SELECTION(tree_sel),
01074                                              (GtkTreeModel **)&amp;interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>);
01075         <span class="keywordflow">if</span> (selection_list != NULL) {                                         
01076            tmp_path  = g_list_first(selection_list);
01077            gtk_tree_path_prev(tmp_path-&gt;data);   
01078            gtk_tree_selection_select_path  (tree_sel, tmp_path-&gt;data);
01079            gtk_tree_view_scroll_to_cell(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>),
01080                                                   tmp_path-&gt;data,
01081                                                   COLUMN_DESIGNATOR,
01082                                                   TRUE,
01083                                                   0.3,
01084                                                   0.5);
01085         }
01086    
01087         
01088         <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01089     
01090      <span class="comment">/*</span>
01091 <span class="comment">      * g_free(tree_sel);CHECK ME:do we need to free them?</span>
01092 <span class="comment">      */</span>
01093         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;keyval == GDK_Down) {
01094             GtkTreeSelection  *tree_sel = NULL;
01095             GList             *selection_list, *tmp_path;
01096                 
01097         
01098             tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
01099             selection_list = gtk_tree_selection_get_selected_rows
01100                                                 (GTK_TREE_SELECTION(tree_sel),
01101                                                  (GtkTreeModel **)&amp;interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>);
01102             <span class="keywordflow">if</span> (selection_list != NULL) {                                         
01103                tmp_path  = g_list_last(selection_list);
01104                gtk_tree_path_next(tmp_path-&gt;data);   
01105                gtk_tree_selection_select_path  (tree_sel, tmp_path-&gt;data);
01106                gtk_tree_view_scroll_to_cell(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>),
01107                                                       tmp_path-&gt;data,
01108                                                       COLUMN_DESIGNATOR,
01109                                                       TRUE,
01110                                                       0.3,
01111                                                       0.5);
01112                                                   
01113             }
01114             <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01115     
01116          <span class="comment">/*</span>
01117 <span class="comment">          * g_free(tree_sel);CHECK ME:do we need to free them?</span>
01118 <span class="comment">          */</span>
01119         }
01120      } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> ((event-&gt;keyval == GDK_space) || (event-&gt;keyval == GDK_downarrow) || (event-&gt;keyval == GDK_Down)) {
01121         <span class="comment">/* We loop through the current selection, as soon we found the first, </span>
01122 <span class="comment">            * the following item will automatically  be selected and the rest unselected</span>
01123 <span class="comment">            * and returned.</span>
01124 <span class="comment">            */</span>
01125         GtkTreeSelection  *tree_sel = NULL;
01126         GList             *selection_list, *tmp_path;
01127                 
01128         
01129         tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
01130         selection_list = gtk_tree_selection_get_selected_rows
01131                                             (GTK_TREE_SELECTION(tree_sel),
01132                                              (GtkTreeModel **)&amp;interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>);
01133         <span class="keywordflow">if</span> (selection_list != NULL) {                                         
01134            tmp_path  = g_list_first(selection_list);
01135            gtk_tree_selection_unselect_all  (tree_sel);
01136            gtk_tree_path_next(tmp_path-&gt;data);   
01137           <span class="comment">// if (tmp_path-&gt;data != NULL) {</span>
01138                gtk_tree_selection_select_path  (tree_sel, tmp_path-&gt;data);
01139                gtk_tree_view_scroll_to_cell(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>),
01140                                                       tmp_path-&gt;data,
01141                                                       COLUMN_DESIGNATOR,
01142                                                       TRUE,
01143                                                       0.3,
01144                                                       0.5);
01145           <span class="comment">// }                                                      </span>
01146                                                   
01147         }
01148         <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01149     
01150      <span class="comment">/*</span>
01151 <span class="comment">      * g_free(tree_sel);CHECK ME:do we need to free them?</span>
01152 <span class="comment">      */</span>
01153     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;keyval == GDK_Return) {
01154        <span class="comment">/* printf("enter key was pressed!\n");</span>
01155 <span class="comment">        GtkTreeSelection  *tree_sel = NULL;   </span>
01156 <span class="comment">        tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.tree));</span>
01157 <span class="comment">        gtk_tree_selection_unselect_all (tree_sel);*/</span>
01158         <span class="keywordflow">return</span> TRUE;
01159     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((event-&gt;keyval == GDK_Up) || (event-&gt;keyval == GDK_uparrow)) {
01160     
01161         GtkTreeSelection  *tree_sel = NULL; 
01162         GList             *selection_list, *tmp_path;
01163                 
01164 
01165         
01166         tree_sel = gtk_tree_view_get_selection(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>));
01167         selection_list = gtk_tree_selection_get_selected_rows
01168                                             (GTK_TREE_SELECTION(tree_sel),
01169                                              (GtkTreeModel **)&amp;interface.<a class="code" href="struct__InterfaceStruct.html#o17">model</a>);
01170         <span class="keywordflow">if</span> (selection_list != NULL) {                                         
01171            tmp_path  = g_list_first(selection_list);
01172            gtk_tree_selection_unselect_all  (tree_sel);
01173            gtk_tree_path_prev(tmp_path-&gt;data);   
01174            gtk_tree_selection_select_path  (tree_sel, tmp_path-&gt;data);
01175            gtk_tree_view_scroll_to_cell(GTK_TREE_VIEW(interface.<a class="code" href="struct__InterfaceStruct.html#o13">tree</a>),
01176                                                   tmp_path-&gt;data,
01177                                                   COLUMN_DESIGNATOR,
01178                                                   TRUE,
01179                                                   0.3,
01180                                                   0.5);
01181         }
01182    
01183         
01184         <a class="code" href="search__gui_8c.html#a15">click_find_cb</a>(interface.<a class="code" href="struct__InterfaceStruct.html#o1">find_button</a>, NULL);
01185     
01186         }
01187     
01188      <span class="comment">/*</span>
01189 <span class="comment">      * g_free(tree_sel);CHECK ME:do we need to free them?</span>
01190 <span class="comment">      */</span>      
01191        gtk_window_activate_focus(GTK_WINDOW(interface.<a class="code" href="struct__InterfaceStruct.html#o2">main_window</a>)); 
01192     <span class="keywordflow">return</span> TRUE;
01193 } <span class="comment">/* file_key_press_event_cb */</span>
01194 <span class="preprocessor">#endif </span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Oct 13 16:09:21 2004 for gerbv by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.8-20040928 </small></address>
</body>
</html>
